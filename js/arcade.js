const o=document.getElementById("scoreTable"),M=document.querySelector(".game-score span"),r=document.querySelector(".game-over"),q=document.querySelector(".play-again"),a=[{name:"tower",scores:[]},{name:"jump",scores:[]},{name:"snake",scores:[]}];let l,s=1,k=2,B=[],d=[],n;const t=e=>{-1<["Space","ArrowUp","ArrowDown"].indexOf(e.code)&&e.preventDefault()},i=(window.addEventListener("resize",()=>{e(!1,0)}),document.getElementById("djf9g").addEventListener("click",()=>{e(!0,-60)}),document.getElementById("r9ghh").addEventListener("click",()=>{e(!0,60)}),document.querySelectorAll(".play-button").forEach(e=>{e.addEventListener("click",()=>{switch(document.addEventListener("keydown",t),document.getElementById("gameText").style.display="block",document.getElementById(e.getAttribute("data-type")+"Wrapper").style.display="block",s){case 1:i();break;case 2:c();break;case 3:C()}})}),document.getElementById("gameBack").addEventListener("pointerdown",()=>{document.querySelectorAll(".game-wrapper").forEach(e=>e.style.display="none"),document.getElementById("gameText").style.display="none",document.querySelector(".game-score span").textContent="0",D(!1),W(!0),document.removeEventListener("keydown",t)}),document.querySelectorAll(".question").forEach(t=>{t.addEventListener("pointerdown",e=>{e.stopPropagation(),t.nextElementSibling.classList.toggle("active")})}),document.querySelectorAll(".close").forEach(t=>{t.addEventListener("pointerdown",e=>{e.stopPropagation(),t.parentElement.classList.remove("active")})}),()=>{let s=S(!0),d=s.getContext("2d");const i=document.getElementById("towerWrapper"),c=document.getElementById("cake");let m,h,u,p,y;const g=5,f=50,w=300,v=[{x:s.width/2-s.width/6,y:150,offset:0,width:Math.min(s.width/3,w),score:0,ratio:.75}];let E={x:0,y:0,width:0};function x(){v[u]={x:0,y:(u+8)*f,offset:0,width:v[u-1].width,score:0,ratio:v[u-1].width/s.width}}function k(){if("gameOver"!==y){d.clearRect(0,0,s.width,s.height),M.textContent=v.reduce((e,t)=>e+t.score,0).toString();for(let e=0;e<v.length;e++){var t=v[e];t.width=Math.min(s.width*t.ratio,w),e<v.length-1&&(t.x=s.width/2-v[0].width/2+t.offset),d.save(),n=d,o=t.x,r=500-t.y+h,t=t.width,a=f,l=8,n.beginPath(),n.moveTo(o+l,r),n.lineTo(o+t-l,r),n.quadraticCurveTo(o+t,r,o+t,r+l),n.lineTo(o+t,r+a-l),n.lineTo(o+t,r+a),n.lineTo(o+l,r+a),n.lineTo(o,r+a),n.lineTo(o,r+l),n.quadraticCurveTo(o,r,o+l,r),n.closePath(),n.clip(),n.drawImage(c,0,0,4*t,200,o,r,t,a),n.restore()}var n,o,r,a,l;if(d.fillStyle="lightgrey",d.fillRect(E.x,500-E.y+h,E.width,f),"bounce"==y&&(v[u].x=v[u].x+p,(p=0<p&&v[u].x+v[u].width>s.width?-p:p)<0)&&v[u].x<0&&(p=-p),"fall"==y&&(v[u].y=v[u].y-g,v[u].y==v[u-1].y+f)){y="bounce";var e=v[u].x-v[u-1].x;if(Math.abs(e)>=v[u].width)return y="gameOver",void D(!0,v.reduce((e,t)=>e+t.score,0));E={x:E.x,y:v[u].y,width:e},v[u].x>v[u-1].x?(v[u].width=v[u].width-e,v[u].offset=v[u].x-v[0].x,E.x=v[u].x+v[u].width):(E.x=v[u].x-e,v[u].width=v[u].width+e,v[u].x=v[u-1].x,v[u].offset=v[u-1].offset),v[u].ratio=v[u].width/s.width,v[u].score=Math.floor(v[u].width/v[u-1].width*100),0<p?p+=.5:p-=.5,i.style.setProperty("--kitchenHeight",3*u+"%"),u++,m=f,x()}E.y=E.y-g,m&&(h++,m--),window.requestAnimationFrame(k)}}function t(){D(!1),v.splice(1,v.length-1),"gameOver"===y&&window.requestAnimationFrame(k),y="bounce",h=0,m=0,p=2,u=1,v[0].width=.75*s.width,i.style.setProperty("--kitchenHeight","0"),x(),E.y=0,q.addEventListener("pointerup",t)}var e=e=>{e=e.key||"Tap";"Enter"===e&&"gameOver"===y?t():"ArrowDown"!==e&&" "!==e&&"Tap"!==e||"bounce"==y&&(y="fall")};P(document,"keydown",e),s.addEventListener("pointerdown",e);P(window,"resize",()=>S(!1)),t(),k()}),c=()=>{const r=document.getElementById("jumpWrapper"),t=(r.style.display="block",document.getElementById("door"));let o=0,n=!1,a=!0,l=0,s=1e3,d=2e3,i=!1,c,m,h=1.5,u=!1,p=!1;const y=(e,t)=>{var n;"true"!==e.getAttribute("data-removed")&&(e.setAttribute("data-removed","true"),n=setTimeout(()=>{e.remove(),clearInterval(B[t])},1e3),B.push(n),M.textContent=(++o).toString())},g=(e,t)=>{var n=b(e,"left"),o=.33*b(r.firstElementChild,"width");n<o&&o-20<n&&l<=100&&(e.classList.contains("crasher")?(e.style.animation="arc 3s linear",e.style.backgroundColor="transparent",e.firstElementChild.style.animationPlayState="running",y(e,t)):x()),n<=o-100&&(e.classList.contains("crasher")?x():y(e,t))},f=()=>{var e,t,n;p||6<document.querySelectorAll(".obstacle").length||(n=document.createElement("template"),t=(t=Math.floor(12*Math.random())+1)%6==0?"crasher crasher"+t:"guest guest"+t,e=Math.floor(11*Math.random())+80,n.innerHTML=`<div class="obstacle ${t}"><div class="rotate-out"></div></div>`,t=n.content.firstElementChild,o%10==0&&L(o/100),t.style.animationDuration=k+"s",t.style.height=e+"px",r.firstElementChild.insertAdjacentElement("beforeend",t),B.push(setInterval(g,10,t,B.length)),n=10*Math.round((Math.random()*(d-s)+s)/10),B.push(setTimeout(f,n)))};var e=e=>{e=e.key||"Tap";"Enter"===e&&i?v():"p"===e?E():"ArrowUp"!==e&&" "!==e&&"Tap"!==e||(u||v(),a&&!n&&(n=!0,a=!1,0===l&&(l=h),clearInterval(c),c=setInterval(()=>{!(n=175<=l?!1:n)&&l<=50&&(a=!0),l<=0&&(n=!1,a=!0,clearInterval(c),l=h),n?t.style.transform=`translateY(-${l+=h}px)`:t.style.transform=`translateY(-${l-=h}px)`},.1)))},w=e=>{e=e.key||"Tap";"ArrowUp"!==e&&" "!==e&&"Tap"!==e||(n=!1)};function v(){u=!0,M.textContent="0",D(!1),W(!1),document.querySelectorAll(".obstacle").forEach(e=>e.remove()),h=1.5,d=2e3,i=!1,p=!1,L(0),f(),B.push(setInterval(()=>{900<d&&(d-=100),h<=3&&(h+=.1)},5e3))}const E=()=>{const t=(p=!p)?"paused":"running";var e;document.querySelectorAll(".obstacle").forEach(e=>{e.style.animationPlayState=t}),p?clearTimeout(m):(e=b(document.querySelector(".obstacle:last-child"),"left"),m=setTimeout(f,e-500))},x=()=>{E(),W(!1),D(!0,o),o=0,i=!0,u=!1};q.addEventListener("pointerup",v),P(document,"keydown",e),r.addEventListener("pointerdown",e),P(document,"keyup",w),r.addEventListener("pointerup",w);P(window,"resize",()=>L(0)),L(0)},C=()=>{console.log("snake"),document.getElementById("snakeWrapper").style.display="block";const n=document.getElementById("snake"),e=document.getElementById("food");let{blockSize:o,total_row:r,total_col:a,height:l,width:s}=j(),d,i,c,m,h,u,p,t,y=[],g=0,f=!1,w=!1;function v(){if(!w&&!f){d==h&&i==u&&(y.push([h,u]),n.insertAdjacentHTML("beforeend",`<div class="pixel snake-pixel" style="left:${h}px;top:${u}px"><div class="flower food${p}"></div></div>`),M.textContent=(++g).toString(),I());for(let e=y.length-1;0<e;e--)y[e]=y[e-1];if(y.length&&(y[0]=[d,i]),d+=c*o,i+=m*o,d<0||d>=s||i<0||i>=l)A();else{for(let e=0;e<y.length;e++)if(d==y[e][0]&&i==y[e][1])return void A();var e=document.querySelector(".snake-pixel:nth-child(1)");e.style.left=d+"px",e.style.top=i+"px";for(let e=0;e<y.length;e++){var t=document.querySelector(`.snake-pixel:nth-child(${e+2})`);t.style.left=y[e][0]+"px",t.style.top=y[e][1]+"px"}}}}function E(e,t,n){f||(document.querySelector(".snake-pixel:nth-child(1)").className="pixel snake-pixel snake-head head-"+n,c=e,m=t,v(),w=!0,setTimeout(()=>w=!1,100))}function x(e){"Enter"===e.key&&f?T():"ArrowUp"==e.code&&1!=m?E(0,-1,"up"):"ArrowRight"==e.code&&-1!=c?E(1,0,"right"):"ArrowDown"==e.code&&-1!=m?E(0,1,"down"):"ArrowLeft"==e.code&&1!=c&&E(-1,0,"left")}let k=0,b=0,L,S;function I(){var n=[];for(let t=0;t<a*o;t+=o)for(let e=0;e<r*o;e+=o)y.some(n=>[t,e].every((e,t)=>e===n[t]))||n.push([t,e]);[h,u]=n[Math.floor(Math.random()*n.length)],e.style.left=h+"px",e.style.top=u+"px",e.style.animation="none",e.offsetHeight,e.style.animation=null,p=Math.floor(9*Math.random())+1,e.className="pixel food"+p}function T(){D(!1),W(!0),d=Math.floor(a/2)*o,i=Math.floor(r/2)*o,c=0,m=0,g=0,y=[],f=!1,M.textContent="0",n.innerHTML=`<div class="pixel snake-pixel snake-head head-right" style="left:${d}px;top:${i}px"></div>`,I(),P(document,"keydown",x),q.addEventListener("pointerup",C);P(window,"resize",()=>({blockSize:o,total_row:r,total_col:a,height:l,width:s}=j())),t=setInterval(v,150),B.push(t)}document.addEventListener("touchstart",e=>{e.preventDefault(),k=e.changedTouches[0].screenX,b=e.changedTouches[0].screenY},{passive:!1}),document.addEventListener("touchend",e=>{e.preventDefault(),L=e.changedTouches[0].screenX,S=e.changedTouches[0].screenY,Math.abs(k-L)>Math.abs(b-S)?(L<k&&E(-1,0,"left"),L>k&&E(1,0,"right")):(S<b&&E(0,-1,"up"),S>b&&E(0,1,"down"))},{passive:!1});const A=()=>{D(!0,g),W(!1),f=!0};T()},P=(e,t,n)=>{e.addEventListener(t,n),d.push({elem:e,name:t,callback:n})},b=(e,t)=>parseInt(window.getComputedStyle(e).getPropertyValue(t)),e=(e,t)=>{var n=document.documentElement.style.getPropertyValue("--offset")||"0deg",n=parseInt(n,10)+t;s=Math.abs((n%180+180)%180)/60+1,l=a[s-1],e?(document.body.classList.add("t8gg4"),document.documentElement.style.setProperty("--offset",n+"deg"),u(s)):(document.body.classList.remove("t8gg4"),t=document.querySelector(`.sid7g:nth-child(${s})`).getBoundingClientRect().height+20,document.documentElement.style.setProperty("--slideHeight",t+"px"))};function L(e){var t=document.getElementById("jumpWrapper").firstElementChild.offsetWidth;(k=t/200-e)<1&&(k=1)}const S=e=>{e&&(document.getElementById("towerWrapper").style.display="block");e=document.getElementById("towerCanvas");return e.width=e.parentElement.offsetWidth,e},j=()=>{var e=document.getElementById("snakeWrapper"),t=document.getElementById("board"),n=Math.min(Math.floor(window.innerWidth/10),50),o=(e.style.setProperty("--blockSize",n+"px"),Math.floor(.8*b(e,"height")/n)),e=Math.floor(.9*b(e,"width")/n),r=o*n,a=e*n;return t.style.width=a+"px",t.style.height=r+"px",t.parentElement.style.height=t.style.height,t.parentElement.style.width=t.style.width,{blockSize:n,total_row:o,total_col:e,height:r,width:a}},W=e=>{for(var t=window.requestAnimationFrame(()=>{});t--;)window.cancelAnimationFrame(t);B.forEach(e=>{clearInterval(e),clearTimeout(e)}),B=[],e&&(d.forEach(e=>{e.elem.removeEventListener(e.name,e.callback)}),d=[])},D=(e,t=0)=>{let n;e?(r.style.display="flex",n=.2,m(t)):(r.style.display="none",document.querySelectorAll(".new-rank").forEach(e=>e.style.display="none"),n=1),document.querySelectorAll(".game").forEach(e=>e.style.filter=`saturate(${n})`)},m=e=>{var t;0===e||(t=t=>l.scores.find(e=>e.name==t.name&&e.score===t.score))(e={name:n,score:e,rank:0,timestamp:Date.now()})||(l.scores.push(e),l.scores=l.scores.sort((e,t)=>t.score-e.score||e.timestamp-t.timestamp).slice(0,10),t(e)&&(document.querySelectorAll(".new-rank").forEach(e=>e.style.display="block"),document.getElementById("leaderBoardSection").classList.add("loading-scores"),l.scores.map(e=>e.rank=0),h(e)))},h=e=>{var t=new FormData;t.append("game",l.name),t.append("name",e.name),t.append("score",e.score.toString()),t.append("timestamp",Date.now().toString());fetch("https://script.google.com/macros/s/AKfycbxKTCdLjG9CLyaNPRw9jwjrEop2W5oeeeoQ4PAJFbDh0lkJOuxIOi17guVomYuqsZNX9A/exec",{method:"POST",body:t}).then(()=>u(s))};const u=e=>{document.querySelectorAll(".rank").forEach(e=>e.remove());const n=a[e-1].scores;n.forEach((e,t)=>{e.rank=e.rank||t+1,0<t&&n[t-1].score===e.score&&(e.rank=n[t-1].rank);t=`
        <tr class="rank">
          <td>${("0"+e.rank).slice(-2)}</td>
          <td>${e.name}</td>
          <td>${e.score}</td>
        </tr>`;o.firstElementChild.insertAdjacentHTML("beforeend",t)}),document.getElementById("leaderBoardSection").classList.remove("loading-scores")};e(!1,0);{const p=[];a.forEach(e=>{e=new URL("https://script.google.com/macros/s/AKfycbwtlv5tXcWr_9EYG3oY7R26Nm0VELhgztbdHqlR_38ZEMT4-QYnyeMOp7j8NmE2TSdgRA/exec?game="+e.name);p.push(fetch(e))}),Promise.all(p).then(e=>{let n=0;e.forEach((e,t)=>{e.json().then(e=>{e.forEach(e=>{a[t].scores.push({name:e.name,score:e.score,rank:0,timestamp:e.timestamp})}),++n===a.length&&u(s)})})})}{const y=document.getElementById("nameModal"),g=document.getElementById("playerName"),f=document.getElementById("submitName"),w=(document.getElementById("changePlayer").addEventListener("pointerdown",()=>{document.removeEventListener("keydown",t),y.style.display="block"}),g.addEventListener("keyup",()=>{f.disabled=""===g.value}),f.addEventListener("pointerdown",()=>{n=g.value,localStorage.setItem("playerName",n),w.textContent=n,document.addEventListener("keydown",t),y.style.display="none"}),document.querySelector("#currentPlayer #displayName"));(n=localStorage.getItem("playerName"))?w.textContent=n:(document.removeEventListener("keydown",t),y.style.display="block")}